machine:
  services:
    - docker
  node:
    version: 6.1.0

dependencies:
  pre:
    - BUILD_BACKEND=$(git diff-tree --no-commit-id --name-only $CIRCLE_SHA1 | grep backend )
    - BUILD_FRONTEND=$(git diff-tree --no-commit-id --name-only $CIRCLE_SHA1 | grep frontend-web )
    - if [ $BUILD_BACKEND ]; then bash scripts/ci/backend/dependencies--pre.sh; fi
  override:
    - if [ $BUILD_BACKEND ]; then bash scripts/ci/backend/dependencies--override.sh; fi
  cache_directories:
    - backend/.gradle
    - tools

test:
  override:
    - if [ $BUILD_BACKEND ]; then bash scripts/ci/backend/test--override.sh; fi
  post:
    - if [ $BUILD_BACKEND ]; then bash scripts/ci/backend/test--post.sh; fi

deployment:
  develop:
    branch: develop
    commands:
      - if [ $BUILD_BACKEND ]; then bash script/ci/backend/deployment--develop--commands.sh; fi
  master:
    branch: master
    commands:
      - bash script/ci/backend/deployment--develop--commands.sh
